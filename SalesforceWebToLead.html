
<!--  ------------------------------------------------------------------------------------------------  -->
<!--  This script was developed by Gustavo Azevedo, based on Web-To-Lead developed by Salesforce.       -->
<!--  The script aims to enable the integration of Salesforce Web-To-Lead with WordPress                -->
<!--  especially when using Cornerstone.                                                                -->
<!--  We recommend using this code through the WP Code Plugin with its Code Snipped functionality       -->
<!--  in Shortcode mode.                                                                                -->
<!--  If you need support, please contact me on Email                                                   -->
<!--  Email: azevedosgustavo@gmail.com                                                                  -->
<!--  GIT HUB https://github.com/azevedosgustavo                                                        -->
<!--  Salesforce, Wordpress, CorneStore, WP Code, Google, LinkedIn and gitHub                           -->
<!--  are independent brands that own their own patents.                                                -->
<!--  ------------------------------------------------------------------------------------------------  -->

<!--  ----------------------------------------------------------------------  -->
<!--  NOTE: Please add the following <META> element to your page <HEAD>.      -->
<!--  If necessary, please modify the charset parameter to specify the        -->
<!--  character set of your HTML page.                                        -->
<!--  ----------------------------------------------------------------------  -->

<!--  ------------------------------------------------------  -->
<!--  Attention: Replace Key values.                          -->
<!--  xxxxORGIDxxxx - OrgId                                   -->
<!--  xxxxRetURLxxxx - Return URL                             -->
<!--  xxxxDataSiteKeyxxxx - g-Recaptcha Site Key              -->
<!--  xxxxKeyNamexxxx - Recaptcha Key Name in Salesforce      -->
<!--  ------------------------------------------------------  -->

<META HTTP-EQUIV="Content-type" CONTENT="text/html; charset=UTF-8">
<script src="https://www.google.com/recaptcha/api.js"></script>
<script>
(
    function () {
        const FORM_SELECTOR = 'form[action*="servlet/servlet.WebToLead"]';

        function buildValue() {
            return JSON.stringify({
            keyname: "xxxxKeyNamexxxx", //ADD ReCAPTCHA KEYNAME
            fallback: false,
            orgId: "xxxxORGIDxxxx",  //Add ORGID
            ts: Date.now()
            });
        }

        function syncAll() {
            const val = buildValue();
            const inputs = document.querySelectorAll('input[name="captcha_settings"]');
            inputs.forEach((el, i) => {
            el.value = val;                
            el.setAttribute('value', val);  
            });
        }

        setInterval(() => {
            const resp = document.getElementById('g-recaptcha-response');
            if (!resp || !resp.value || !resp.value.trim()) syncAll();
        }, 250);

        const mo = new MutationObserver(syncAll);
        mo.observe(document.documentElement, { childList: true, subtree: true });

        window.addEventListener('DOMContentLoaded', () => {
            const form = document.querySelector(FORM_SELECTOR) || document.querySelector('form');
            if (!form) return;

            form.addEventListener('submit', (ev) => {
            const val = buildValue();

            document.querySelectorAll('input[name="captcha_settings"]').forEach(el => {
                if (el.parentNode) el.parentNode.removeChild(el);
            });

            const hidden = document.createElement('input');
            hidden.type = 'hidden';
            hidden.name = 'captcha_settings';
            hidden.value = val;
            hidden.setAttribute('value', val);
            form.insertBefore(hidden, form.firstChild);

            }, true);
        });
    }
)();
</script>

<!--  ----------------------------------------------------------------------  -->
<!--  NOTE: Please add the following <FORM> element to your page.             -->
<!--  ----------------------------------------------------------------------  -->

<form action="https://test.salesforce.com/servlet/servlet.WebToLead?encoding=UTF-8&orgId=xxxxORGIDxxxx" method="POST"> <!--Add OrgId-->

<input type="hidden" name="captcha_settings" value='{"keyname":"xxxxKeyNamexxxx","fallback":false,"orgId":"xxxxORGIDxxxx","ts":""}'> <!--Add OrgId and Recaptcha Key Name no Salesforce-->

<input type=hidden name="oid" value="xxxxORGIDxxxx"><!--Add OrgId-->
<input type=hidden name="retURL" value="xxxxRetURLxxxx"><!--Add Ret URL-->

<!--  ----------------------------------------------------------------------  -->
<!--  NOTE: These fields are optional debugging elements. Please uncomment    -->
<!--  these lines if you wish to test in debug mode.                          -->
<!--   <input type="hidden" name="debug" value=1>       -->                        
<!--  <input type="hidden" name="debugEmail" value="your email">   -->                       
<!--  ----------------------------------------------------------------------  -->

<label for="first_name">First Name Test</label><input  id="first_name" maxlength="40" name="first_name" size="20" type="text" /><br>

<label for="last_name">Last Name</label><input  id="last_name" maxlength="80" name="last_name" size="20" type="text" /><br>

<label for="email">Email</label><input  id="email" maxlength="80" name="email" size="20" type="text" /><br>

<label for="company">Company</label><input  id="company" maxlength="40" name="company" size="20" type="text" /><br>

<label for="city">City</label><input  id="city" maxlength="40" name="city" size="20" type="text" /><br>

<label for="state">State/Province</label><input  id="state" maxlength="20" name="state" size="20" type="text" /><br>

<div class="g-recaptcha" data-sitekey="xxxxDataSiteKeyxxxx"></div><br> <!--Add g-Recaptcha Site Key-->
<input type="submit" name="submit">

</form>
